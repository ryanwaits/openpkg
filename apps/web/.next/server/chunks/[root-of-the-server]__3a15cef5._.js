module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},22632,e=>{"use strict";e.s([],54033),e.i(54033);var t=e.i(85676),r=e.i(80264);e.s(["defaultErrorMap",()=>r.default,"getErrorMap",()=>t.getErrorMap,"setErrorMap",()=>t.setErrorMap],76733),e.i(76733);var o=e.i(84488);e.s([],91316),e.i(91316);var n=e.i(42944),a=e.i(17958),i=e.i(15235);e.s(["BRAND",()=>a.BRAND,"DIRTY",()=>o.DIRTY,"EMPTY_PATH",()=>o.EMPTY_PATH,"INVALID",()=>o.INVALID,"NEVER",()=>a.NEVER,"OK",()=>o.OK,"ParseStatus",()=>o.ParseStatus,"Schema",()=>a.Schema,"ZodAny",()=>a.ZodAny,"ZodArray",()=>a.ZodArray,"ZodBigInt",()=>a.ZodBigInt,"ZodBoolean",()=>a.ZodBoolean,"ZodBranded",()=>a.ZodBranded,"ZodCatch",()=>a.ZodCatch,"ZodDate",()=>a.ZodDate,"ZodDefault",()=>a.ZodDefault,"ZodDiscriminatedUnion",()=>a.ZodDiscriminatedUnion,"ZodEffects",()=>a.ZodEffects,"ZodEnum",()=>a.ZodEnum,"ZodError",()=>i.ZodError,"ZodFirstPartyTypeKind",()=>a.ZodFirstPartyTypeKind,"ZodFunction",()=>a.ZodFunction,"ZodIntersection",()=>a.ZodIntersection,"ZodIssueCode",()=>i.ZodIssueCode,"ZodLazy",()=>a.ZodLazy,"ZodLiteral",()=>a.ZodLiteral,"ZodMap",()=>a.ZodMap,"ZodNaN",()=>a.ZodNaN,"ZodNativeEnum",()=>a.ZodNativeEnum,"ZodNever",()=>a.ZodNever,"ZodNull",()=>a.ZodNull,"ZodNullable",()=>a.ZodNullable,"ZodNumber",()=>a.ZodNumber,"ZodObject",()=>a.ZodObject,"ZodOptional",()=>a.ZodOptional,"ZodParsedType",()=>n.ZodParsedType,"ZodPipeline",()=>a.ZodPipeline,"ZodPromise",()=>a.ZodPromise,"ZodReadonly",()=>a.ZodReadonly,"ZodRecord",()=>a.ZodRecord,"ZodSchema",()=>a.ZodSchema,"ZodSet",()=>a.ZodSet,"ZodString",()=>a.ZodString,"ZodSymbol",()=>a.ZodSymbol,"ZodTransformer",()=>a.ZodTransformer,"ZodTuple",()=>a.ZodTuple,"ZodType",()=>a.ZodType,"ZodUndefined",()=>a.ZodUndefined,"ZodUnion",()=>a.ZodUnion,"ZodUnknown",()=>a.ZodUnknown,"ZodVoid",()=>a.ZodVoid,"addIssueToContext",()=>o.addIssueToContext,"any",()=>a.any,"array",()=>a.array,"bigint",()=>a.bigint,"boolean",()=>a.boolean,"coerce",()=>a.coerce,"custom",()=>a.custom,"date",()=>a.date,"datetimeRegex",()=>a.datetimeRegex,"defaultErrorMap",()=>r.default,"discriminatedUnion",()=>a.discriminatedUnion,"effect",()=>a.effect,"enum",()=>a.enum,"function",()=>a.function,"getErrorMap",()=>t.getErrorMap,"getParsedType",()=>n.getParsedType,"instanceof",()=>a.instanceof,"intersection",()=>a.intersection,"isAborted",()=>o.isAborted,"isAsync",()=>o.isAsync,"isDirty",()=>o.isDirty,"isValid",()=>o.isValid,"late",()=>a.late,"lazy",()=>a.lazy,"literal",()=>a.literal,"makeIssue",()=>o.makeIssue,"map",()=>a.map,"nan",()=>a.nan,"nativeEnum",()=>a.nativeEnum,"never",()=>a.never,"null",()=>a.null,"nullable",()=>a.nullable,"number",()=>a.number,"object",()=>a.object,"objectUtil",()=>n.objectUtil,"oboolean",()=>a.oboolean,"onumber",()=>a.onumber,"optional",()=>a.optional,"ostring",()=>a.ostring,"pipeline",()=>a.pipeline,"preprocess",()=>a.preprocess,"promise",()=>a.promise,"quotelessJson",()=>i.quotelessJson,"record",()=>a.record,"set",()=>a.set,"setErrorMap",()=>t.setErrorMap,"strictObject",()=>a.strictObject,"string",()=>a.string,"symbol",()=>a.symbol,"transformer",()=>a.transformer,"tuple",()=>a.tuple,"undefined",()=>a.undefined,"union",()=>a.union,"unknown",()=>a.unknown,"util",()=>n.util,"void",()=>a.void],35907);var s=e.i(35907);e.s(["z",0,s],22632)},32828,e=>{"use strict";var t=e.i(66680),r=e.i(27356);let o="doccov_";function n(){let e=(0,r.nanoid)(32),t=`${o}${e}`,n=a(t),i=t.slice(0,12);return{key:t,hash:n,prefix:i}}function a(e){return(0,t.createHash)("sha256").update(e).digest("hex")}function i(e){return e.startsWith(o)&&e.length===o.length+32}e.s(["generateApiKey",()=>n,"hashApiKey",()=>a,"isValidKeyFormat",()=>i])},30682,e=>{"use strict";var t=e.i(32828);async function r(e,r){let o=e.headers.get("Authorization");if(!o)return{ok:!1,error:"API key required",status:401,docs:"https://docs.doccov.com/api-keys"};if(!o.startsWith("Bearer "))return{ok:!1,error:"Invalid Authorization header. Use: Bearer <api_key>",status:401};let n=o.slice(7);if(!(0,t.isValidKeyFormat)(n))return{ok:!1,error:"Invalid API key format",status:401};let a=(0,t.hashApiKey)(n),i=await r.selectFrom("api_keys").innerJoin("organizations","organizations.id","api_keys.orgId").where("api_keys.keyHash","=",a).where(e=>e.or([e("api_keys.expiresAt","is",null),e("api_keys.expiresAt",">",new Date)])).select(["api_keys.id as keyId","api_keys.orgId","api_keys.name as keyName","organizations.plan","organizations.aiCallsUsed","organizations.aiCallsResetAt"]).executeTakeFirst();return i?"free"===i.plan?{ok:!1,error:"API access requires a paid plan",status:403,upgrade:"https://doccov.com/pricing"}:(r.updateTable("api_keys").set({lastUsedAt:new Date}).where("id","=",i.keyId).execute().catch(console.error),{ok:!0,context:{apiKey:{id:i.keyId,orgId:i.orgId,name:i.keyName},org:{id:i.orgId,plan:i.plan,aiCallsUsed:i.aiCallsUsed,aiCallsResetAt:i.aiCallsResetAt}}}):{ok:!1,error:"Invalid or expired API key",status:401}}e.s(["validateApiKey",()=>r])},26575,e=>{"use strict";var t=e.i(22632);t.z.object({DATABASE_URL:t.z.string().url(),GITHUB_CLIENT_ID:t.z.string().min(1),GITHUB_CLIENT_SECRET:t.z.string().min(1),GITHUB_APP_ID:t.z.string().min(1).optional(),GITHUB_APP_PRIVATE_KEY:t.z.string().min(1).optional(),GITHUB_APP_WEBHOOK_SECRET:t.z.string().min(1).optional(),POLAR_ACCESS_TOKEN:t.z.string().min(1).optional(),POLAR_WEBHOOK_SECRET:t.z.string().min(1).optional(),POLAR_PRODUCT_TEAM:t.z.string().optional(),POLAR_PRODUCT_PRO:t.z.string().optional(),ANTHROPIC_API_KEY:t.z.string().min(1).optional(),OPENAI_API_KEY:t.z.string().min(1).optional(),SITE_URL:t.z.string().url().default("http://localhost:3000"),API_URL:t.z.string().url().default("http://localhost:3001"),SANDBOX_URL:t.z.string().url().optional(),SANDBOX_SECRET:t.z.string().min(1).optional(),NODE_ENV:t.z.enum(["development","production","test"]).default("development")}),e.i(30682);class r{store=new Map;get(e){let t=this.store.get(e);return t&&Date.now()>t.resetAt?void this.store.delete(e):t}increment(e,t){let r=Date.now(),o=this.get(e);if(o)return o.count++,o;let n={count:1,resetAt:r+t};return this.store.set(e,n),n}cleanup(){let e=Date.now();for(let[t,r]of this.store.entries())e>r.resetAt&&this.store.delete(t)}}let o=new r;"undefined"!=typeof setInterval&&setInterval(()=>o.cleanup(),6e4).unref?.(),e.i(32828),e.s([],26575)},75779,e=>e.a(async(t,r)=>{try{var o=e.i(22632);e.i(26575);var n=e.i(30682),a=e.i(3985),i=e.i(88434),s=t([a,i]);[a,i]=s.then?(await s)():s;let l=process.env.SANDBOX_URL,u=o.z.object({mode:o.z.literal("github"),owner:o.z.string().min(1),repo:o.z.string().min(1),base:o.z.string().min(1),head:o.z.string().min(1),includeDocsImpact:o.z.boolean().optional()}),p=o.z.object({mode:o.z.literal("specs"),baseSpec:o.z.object({}).passthrough(),headSpec:o.z.object({}).passthrough(),markdownFiles:o.z.array(o.z.object({path:o.z.string(),content:o.z.string()})).optional()}),c=o.z.discriminatedUnion("mode",[u,p]);async function d(e){let t,r=await (0,n.validateApiKey)(e,a.db);if(!r.ok)return Response.json({error:r.error,docs:r.docs,upgrade:r.upgrade},{status:r.status});let{org:s}=r.context;try{let r=await e.json();t=c.parse(r)}catch(e){if(e instanceof o.z.ZodError)return Response.json({error:"Invalid request",details:e.errors},{status:400});return Response.json({error:"Invalid JSON body"},{status:400})}if(!l)return Response.json({error:"Diff service not available"},{status:501});try{if("github"===t.mode){let{owner:e,repo:r,base:o,head:n,includeDocsImpact:a}=t,d=await (0,i.getInstallationToken)(s.id);if(!d)return Response.json({error:"No GitHub App installation found",hint:"Install the DocCov GitHub App to compare repos"},{status:403});let u=await fetch(`${l}/diff`,{method:"POST",headers:{"Content-Type":"application/json","X-Internal-Token":process.env.SANDBOX_SECRET},body:JSON.stringify({mode:"github",owner:e,repo:r,base:o,head:n,accessToken:d,includeDocsImpact:a})});if(!u.ok){let e=await u.json().catch(()=>({error:"Sandbox error"}));return Response.json(e,{status:u.status})}return Response.json(await u.json())}let e=await fetch(`${l}/diff`,{method:"POST",headers:{"Content-Type":"application/json","X-Internal-Token":process.env.SANDBOX_SECRET},body:JSON.stringify(t)});if(!e.ok){let t=await e.json().catch(()=>({error:"Sandbox error"}));return Response.json(t,{status:e.status})}return Response.json(await e.json())}catch(e){return console.error("Spec diff error:",e),Response.json({error:"Failed to compute diff"},{status:500})}}e.s(["POST",()=>d]),r()}catch(e){r(e)}},!1),38171,e=>e.a(async(t,r)=>{try{var o=e.i(47909),n=e.i(74017),a=e.i(96250),i=e.i(59756),s=e.i(61916),d=e.i(14444),l=e.i(37092),u=e.i(69741),p=e.i(16795),c=e.i(87718),h=e.i(95169),m=e.i(47587),f=e.i(66012),g=e.i(70101),y=e.i(26937),R=e.i(10372),v=e.i(93695);e.i(52474);var E=e.i(220),A=e.i(75779),Z=t([A]);[A]=Z.then?(await Z)():Z;let I=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/v1/spec/diff/route",pathname:"/api/v1/spec/diff",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/v1/spec/diff/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:w,workUnitAsyncStorage:x,serverHooks:_}=I;function b(){return(0,a.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:x})}async function T(e,t,r){I.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let o="/api/v1/spec/diff/route";o=o.replace(/\/index$/,"")||"/";let a=await I.prepare(e,t,{srcPage:o,multiZoneDraftMode:!1});if(!a)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:A,params:Z,nextConfig:b,parsedUrl:T,isDraftMode:w,prerenderManifest:x,routerServerContext:_,isOnDemandRevalidate:P,revalidateOnlyGenerated:C,resolvedPathname:N,clientReferenceManifest:k,serverActionsManifest:S}=a,O=(0,u.normalizeAppPath)(o),z=!!(x.dynamicRoutes[O]||x.routes[N]),j=async()=>((null==_?void 0:_.render404)?await _.render404(e,t,T,!1):t.end("This page could not be found"),null);if(z&&!w){let e=!!x.routes[N],t=x.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await j();throw new v.NoFallbackError}}let D=null;!z||I.isDev||w||(D=N,D="/index"===D?"/":D);let U=!0===I.isDev||!z,M=z&&!U;S&&k&&(0,d.setReferenceManifestsSingleton)({page:o,clientReferenceManifest:k,serverActionsManifest:S,serverModuleMap:(0,l.createServerModuleMap)({serverActionsManifest:S})});let H=e.method||"GET",B=(0,s.getTracer)(),K=B.getActiveScopeSpan(),q={params:Z,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,o)=>I.onRequestError(e,t,o,_)},sharedContext:{buildId:A}},L=new p.NodeNextRequest(e),F=new p.NodeNextResponse(t),V=c.NextRequestAdapter.fromNodeNextRequest(L,(0,c.signalFromNodeResponse)(t));try{let a=async e=>I.handle(V,q).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=B.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${o}`)}),d=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var s,l;let u=async({previousCacheEntry:n})=>{try{if(!d&&P&&C&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await a(i);e.fetchMetrics=q.renderOpts.fetchMetrics;let s=q.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let l=q.renderOpts.collectedTags;if(!z)return await (0,f.sendResponse)(L,F,o,q.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(o.headers);l&&(t[R.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==q.renderOpts.collectedRevalidate&&!(q.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&q.renderOpts.collectedRevalidate,n=void 0===q.renderOpts.collectedExpire||q.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:q.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:o,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:P})},_),t}},p=await I.handleResponse({req:e,nextConfig:b,cacheKey:D,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:C,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:d});if(!z)return null;if((null==p||null==(s=p.value)?void 0:s.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(l=p.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});d||t.setHeader("x-nextjs-cache",P?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),w&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,g.fromNodeOutgoingHttpHeaders)(p.value.headers);return d&&z||c.delete(R.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,y.getCacheControlHeader)(p.cacheControl)),await (0,f.sendResponse)(L,F,new Response(p.value.body,{headers:c,status:p.value.status||200})),null};K?await l(K):await B.withPropagatedContext(e.headers,()=>B.trace(h.BaseServerSpan.handleRequest,{spanName:`${H} ${o}`,kind:s.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:P})}),z)throw t;return await (0,f.sendResponse)(L,F,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>b,"routeModule",()=>I,"serverHooks",()=>_,"workAsyncStorage",()=>w,"workUnitAsyncStorage",()=>x]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__3a15cef5._.js.map